
# Indian Restaurant Order Management System

This is an order management system for an Indian restaurant built with FastAPI, MySQL, and Dialogflow for chatbot integration. It allows customers to place, update, track, and complete orders via a chatbot interface on the frontend.

## Features

- **Place a new order**: Customers can start a new order and add food items.
- **Modify existing orders**: Add or remove items from an ongoing order.
- **Track order status**: Customers can check the status of their placed orders.
- **Complete order**: The system allows customers to complete and submit their orders.
- **Dialogflow Chatbot**: Integrated chatbot for interactive customer support.

## Technologies Used

- **Backend**: FastAPI
- **Database**: MySQL
- **Frontend**: HTML, CSS, Dialogflow chatbot
- **Chatbot Framework**: Dialogflow

## Prerequisites

Before running the application, ensure you have the following installed:

- Python 3.x
- MySQL Server
- FastAPI
- MySQL Connector
- Dialogflow Account (for Chatbot integration)
- `cloudflared.exe` (for local development with Dialogflow fulfillment)

## Installation

1. **Clone the repository:**

   ```bash
   git clone https://github.com/lalit-29r/Food-Chatbot.git
   cd restaurant-order-system
   ```

2. **Install dependencies:**

   ```bash
   pip install -r requirements.txt
   ```

3. **Set up the MySQL database:**

   - Create a database named `indian_restaurant` in MySQL.

   - Ensure the following tables are created:

     - **`food_items`**: For storing the menu items with their names and prices.

       ```sql
       CREATE TABLE food_items (
           id INT AUTO_INCREMENT PRIMARY KEY,
           name VARCHAR(255) NOT NULL,
           price DECIMAL(10, 2) NOT NULL
       );
       ```

     - **`orders`**: For storing order details.

       ```sql
       CREATE TABLE orders (
           order_id INT,
           food_item_id INT,
           quantity INT,
           FOREIGN KEY (food_item_id) REFERENCES food_items(id)
       );
       ```

     - **`order_tracking`**: For tracking order status.

       ```sql
       CREATE TABLE order_tracking (
           order_id INT PRIMARY KEY,
           status VARCHAR(255)
       );
       ```

   - Also create the required stored procedures and functions:

     - **Stored Procedure `insert_order_item`:**

       ```sql
       DELIMITER //
       CREATE PROCEDURE insert_order_item(
           IN food_name VARCHAR(255),
           IN quantity INT,
           IN order_id INT
       )
       BEGIN
           DECLARE food_id INT;
           SELECT id INTO food_id FROM food_items WHERE name = food_name;
           INSERT INTO orders (order_id, food_item_id, quantity) VALUES (order_id, food_id, quantity);
       END //
       DELIMITER ;
       ```

     - **Function `get_total_order_price`:**

       ```sql
       DELIMITER //
       CREATE FUNCTION get_total_order_price(o_id INT)
       RETURNS DECIMAL(10,2)
       DETERMINISTIC
       BEGIN
           DECLARE total DECIMAL(10,2);
           SELECT SUM(fi.price * o.quantity)
           INTO total
           FROM orders o
           JOIN food_items fi ON o.food_item_id = fi.id
           WHERE o.order_id = o_id;
           RETURN total;
       END //
       DELIMITER ;
       ```

4. **Configure Dialogflow:**

   - Set up a Dialogflow agent and integrate it with the frontend by using the agent ID.
   - Replace the `agent-id` in the `home.html` with your Dialogflow agent ID.

5. **Setup Cloudflared for Local Development:**

   If you are using `cloudflared.exe` to expose your local FastAPI server for Dialogflow fulfillment, follow these steps:

   - **Download Cloudflared**: Download and install `cloudflared.exe` from the official Cloudflare website.
   
   - **Create a secure tunnel**: Run the following command to create a tunnel for your local server (assuming your FastAPI server is running on port `8000`):

     ```bash
     cloudflared.exe tunnel --url http://localhost:8000
     ```

     This command will generate a secure HTTPS link, such as `https://<random-id>.cfargotunnel.com`.

   - **Update Dialogflow Webhook URL**:
     - In your Dialogflow console, go to **Fulfillment**.
     - Enable the webhook and paste the HTTPS link generated by `cloudflared` into the webhook URL field.

   - **Test Your Fulfillment**:
     - Once your webhook is set up, test your fulfillment by interacting with the chatbot. The FastAPI application will handle the incoming requests and provide responses.

6. **Run the FastAPI application:**

   ```bash
   uvicorn main:app --reload
   ```

   Your application will be running at `http://127.0.0.1:8000`.

7. **Frontend Setup:**

   - The frontend is in `home.html` and styled using `styles.css`.
   - You can modify images and texts in the HTML to customize the content.

## File Structure

```
Food-Chatbot/
├── Frontend/                          # Frontend folder containing UI files
│   ├── Images/                        # Contains all image assets used in the frontend
│   │   ├── banner.jpg                 # Banner image displayed on the home page
│   │   ├── chole_bhature.png         # Menu item image
│   │   ├── mango_lassi.png           # Menu item image
│   │   ├── masala_dosa.png           # Menu item image
│   │   ├── pav_bhaji.png             # Menu item image
│   │   ├── pizza.png                 # Menu item image
│   │   ├── rava_dosa.png             # Menu item image
│   │   ├── samosa.png                # Menu item image
│   │   ├── vada_pav.png              # Menu item image
│   │   └── veg_biryani.png           # Menu item image
│   ├── home.html                     # Main HTML page for the restaurant's website
│   └── styles.css                    # CSS styling for the website
├── cloudflared.exe                   # Binary to expose local server via HTTPS tunnel for Dialogflow
├── db_handler.py                     # Handles database operations like insert, fetch, and update
├── generic_helper.py                 # Helper functions like extracting session ID and formatting order strings
├── main.py                           # FastAPI backend for handling Dialogflow intents and managing order flow
├── README.md                         # Project overview, setup guide, and usage instructions
└── requirements.txt                  # Python dependencies required to run the FastAPI server
```

## Usage

1. Run the backend server:

   ```bash
   uvicorn main:app --reload
   ```

2. Start the tunnel with cloudflared:

   ```bash
   cloudflared.exe tunnel --url http://127.0.0.1:8000
   ```

3. Copy the generated HTTPS link from cloudflared and:
   - Set it as **Webhook URL** in Dialogflow's Fulfillment section.

4. Open `home.html` with Live Server in your browser.

5. Interact with the chatbot to:
   - Place orders
   - Add or remove items
   - Complete and track orders

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
